<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Healthy Meal | Tracker</title>
  <link rel="stylesheet" href="../assets/styles.css"/>

  <style>
    .hidden{display:none!important;}


	.day-summary-card{
	  border-radius:18px;
	  border:1px solid rgba(148,163,184,.18);
	  background:linear-gradient(135deg,
	    rgba(248,250,252,.98),
	    rgba(243,232,255,.85)
	  );
	  box-shadow:0 10px 24px rgba(15,23,42,.04);
	  font-size:12px;
	  color:#0f172a;
	}
	.day-summary-header{
	  display:flex;
	  justify-content:space-between;
	  align-items:center;
	  margin-bottom:6px;
	  font-size:11px;
	  color:var(--muted);
	}
	.day-summary-title{
	  letter-spacing:.08em;
	  text-transform:uppercase;
	  font-weight:600;
	}
	.day-summary-date{
	  font-weight:600;
	  color:rgba(15,23,42,.8);
	}
	.day-summary-list{
	  margin:2px 0 0;
	  padding:0;
	}

	/* ğŸ”¹ í•œ ì¤„(row) ì •ë ¬ + ê°„ê²© */
	.day-summary-item{
	  display:flex;
	  align-items:center;      /* ì„¸ë¡œ ê°€ìš´ë° ì •ë ¬ */
	  margin-top:4px;
	  column-gap:14px;         /* ë¼ë²¨ê³¼ ê°’ ì‚¬ì´ ê°„ê²© */
	}

	/* ğŸ”¹ ë¼ë²¨ í­ì„ ì¡°ê¸ˆ ë„“ê²Œ (ëŸ¬ì‹œì•„ì–´ ê¸¸ì´ ê³ ë ¤) */
	.day-summary-term{
	  min-width:80px;          /* Ğ¡Ğ¾Ğ½ / ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ / Ğ’Ğ¾Ğ´Ğ° ë‹¤ ë“¤ì–´ê°€ë„ë¡ */
	  font-weight:600;
	  color:rgba(100,116,139,.95);
	}

	/* ğŸ”¹ ê°’ ë¶€ë¶„ì€ ìì—°ìŠ¤ëŸ½ê²Œ, ë¶™ì§€ ì•Šê²Œ */
	.day-summary-desc{
	  flex:0 0 auto;           /* í•„ìš” ì´ìƒìœ¼ë¡œ ëŠ˜ì–´ë‚˜ì§€ ì•Šê²Œ */
	  white-space:nowrap;      /* "4 Ñ‡" ê°™ì´ í•œ ì¤„ ìœ ì§€ */
	}

    /* ë¬¼ íŠ¸ë˜ì»¤ */
    .water-row {
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
      justify-content:space-between;
    }
    .water-dots {
      flex:1;
      display:flex;
      flex-wrap:wrap;
      gap:4px;
      align-items:center;
      justify-content:center;
      max-width:220px;
    }
    .water-dot {
      width:10px;
      height:10px;
      border-radius:999px;
      border:1px solid rgba(22, 163, 74, .22);
      background: rgba(255,255,255,.95);
      box-shadow:0 0 0 1px rgba(255,255,255,.7);
    }
    .water-dot.filled {
      background: rgba(34,197,94,.96);
      border-color: rgba(22,163,74,1);
    }
    .water-btn {
      width:28px;
      height:28px;
      border-radius:999px;
      border:1px solid rgba(22,163,74,.35);
      background: rgba(236,253,245,.9);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:18px;
      cursor:pointer;
    }
    .water-btn:disabled {
      opacity:.35;
      cursor:default;
    }
    .water-label {
      font-size:11px;
      color:var(--muted);
      margin-top:6px;
    }

    /* ìˆ˜ë©´ â€“ ì„¸ ê°€ì§€ ìƒ‰ */
    #sleepNote{
      transition:background .2s, border-color .2s, color .2s;
    }
    .sleep-good{
      background:#dcfce7;
      border-color:#86efac;
      color:#166534;
    }
    .sleep-bad{
      background:#fee2e2;
      border-color:#fecaca;
      color:#b91c1c;
    }
    .sleep-mid{
      background:#dbeafe;
      border-color:#bfdbfe;
      color:#1d4ed8;
    }

    /* ê¸°ë¶„ ì¹´ë“œ â€“ ì„ íƒ ì‹œ ì•± ì „ì²´ ëŠë‚Œì˜ ë°ì€ ë°°ê²½ */
    .mood-card{
      transition: background .15s ease, box-shadow .15s ease, transform .12s ease, border-color .15s ease;
      border-radius:16px;
    }
	.mood-card.selected{
	  background: linear-gradient(135deg,
	      rgba(248,250,252,.95),
	      rgba(236,252,245,.9)
	  );
	  border-color: rgba(22,163,74,.25);
	  box-shadow:0 6px 18px rgba(15,23,42,.08);
	  transform: translateY(-1px);
	}


    /* ê·¸ë˜í”„ + hover */
    .chart-box{
      position:relative;
      border:1px solid rgba(31,34,48,.08);
      border-radius:18px;
      padding:12px;
      background: rgba(255,255,255,.78);
      margin-top:12px;
      overflow:hidden;
    }
    .chart-hit{
      position:absolute;
      top:0;
      bottom:0;
      width:14.285%;
      cursor:pointer;
    }
    .chart-hit:hover{
      background:rgba(148,163,184,.04);
    }
    .chart-tooltip{
      position:absolute;
      min-width:120px;
      max-width:180px;
      padding:8px 10px;
      border-radius:12px;
      background:rgba(255,255,255,.98);
      box-shadow:0 10px 25px rgba(15,23,42,.32);
      font-size:11px;
      color:#0f172a;
      pointer-events:none;
      transform:translateX(-50%);
      z-index:10;
    }
    .chart-tooltip-title{
      font-weight:700;
      margin-bottom:4px;
    }
    .chart-tooltip-row{
      display:flex;
      justify-content:space-between;
      gap:8px;
    }
    .chart-tooltip-label{
      color:rgba(100,116,139,.95);
    }
    #ttEnergyValue{
      color:#3b82f6;
      font-weight:600;
    }
    #ttNutriValue{
      color:#e11d48;
      font-weight:600;
    }

    /* í†µê³„ ì¹´ë“œ */
    .stat-card{
      border-radius:18px;
      border:1px solid rgba(148,163,184,.18);
    }
    .stat-card--energy{
      background:linear-gradient(135deg, rgba(59,130,246,.08), rgba(79,70,229,.02));
    }
    .stat-card--nutrition{
      background:linear-gradient(135deg, rgba(244,63,94,.08), rgba(251,113,133,.02));
    }
    .stat-card--corr{
      background:linear-gradient(135deg, rgba(16,185,129,.08), rgba(22,163,74,.02));
    }
    .stat-value{
      display:inline-flex;
      align-items:center;
      padding:4px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.9);
      box-shadow:0 4px 10px rgba(15,23,42,.06);
      font-size:20px;
      font-weight:900;
      margin-top:6px;
    }
    .stat-value--energy{ color:#3b3fb6; }
    .stat-value--nutrition{ color:#db2777; }
    .stat-value--corr{ color:#166534; }

    /* ë‹¬ë ¥ */
    .calendar-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom:4px;
    }
    .calendar-title {
      font-weight:900;
      font-size:15px;
    }
    .calendar-nav-btn {
      width:28px;
      height:28px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.35);
      background:rgba(248,250,252, .95);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      cursor:pointer;
    }
    .calendar-weekdays {
      display:grid;
      grid-template-columns:repeat(7,1fr);
      font-size:11px;
      text-align:center;
      margin-top:4px;
      color:rgba(100,116,139,.95);
    }
    .calendar-grid {
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:4px;
      margin-top:6px;
    }
    .calendar-cell {
      text-align:center;
      padding:5px 0;
      border-radius:10px;
      font-size:12px;
      color:rgba(100,116,139,.95);
      cursor:pointer;
    }
    .calendar-cell.has-entry {
      background:rgba(22,163,74,.10);
      color:#166534;
      font-weight:600;
    }
    .calendar-cell.today {
      border:1px solid rgba(34,197,94,.85);
      box-shadow:0 0 0 1px rgba(255,255,255,.9);
    }
    .calendar-cell.selected {
      outline:2px solid rgba(79,70,229,.7);
      outline-offset:1px;
    }
    .calendar-cell.empty {
      opacity:0;
      pointer-events:none;
    }
    .calendar-legend {
      margin-top:6px;
      font-size:11px;
      color:var(--muted);
    }
    .calendar-legend span.dot {
      display:inline-block;
      width:10px;
      height:10px;
      border-radius:999px;
      background:rgba(34,197,94,.85);
      margin-right:4px;
      vertical-align:middle;
    }
  </style>
</head>
<body class="page" data-page="tracker">
  <div class="app">
    <main class="main">
      <div class="panel">
        <div class="header">
          <div class="brand">
            <div class="logo" aria-hidden="true">
              <img class="logo-img" src="../assets/logo-leaf.svg" alt="Healthy Meal logo"/>
            </div>
            <div class="brand-text">
              <h1>Healthy Meal</h1>
              <p data-i18n="brand_tagline">ì˜ì–‘ì„ ì¤‘ì‹¬ìœ¼ë¡œ, ê¾¸ì¤€íˆ</p>
            </div>
          </div>

          <div class="top-actions">
            <div class="lang" aria-label="Language">
              <span>Lang</span>
              <button type="button" data-set-lang="ko">KO</button>
              <button type="button" data-set-lang="ru">RU</button>
              <button type="button" data-set-lang="en">EN</button>
            </div>
            <div style="display:flex; gap:10px; align-items:center;"></div>
          </div>
        </div>

        <div class="content">
          <h2 class="title" data-i18n="tracker_title">ê±´ê°• íŠ¸ë˜ì»¤</h2>
          <p class="subtitle" data-i18n="tracker_sub">ì˜ì–‘ì´ ê±´ê°•ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì¶”ì í•˜ì„¸ìš”</p>

          <!-- ìˆ˜ë©´ -->
          <div class="section">
            <div class="card pad">
              <div style="display:flex;align-items:center;gap:10px;font-weight:900;">
                <span class="pill">ğŸŒ™</span> <span data-i18n="sleep">ìˆ˜ë©´ ì‹œê°„</span>
              </div>

              <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;">
                <div style="color:var(--muted);font-size:13px" data-i18n="today_sleep">ì˜¤ëŠ˜ ìˆ˜ë©´</div>
                <div class="pill" id="sleepLabel"  data-i18n="clock">7ì‹œê°„</div>
              </div>

              <input id="sleep" type="range" min="0" max="12" value="7" style="width:100%;margin-top:10px"/>

              <div class="note sleep-good" id="sleepNote" style="margin-top:10px">
                <span id="sleepReaction" data-i18n="sleep_react_ok">âœ“ í›Œë¥­í•´ìš”! ê¶Œì¥ ìˆ˜ë©´ ì‹œê°„ì„ ì§€í‚¤ê³  ìˆì–´ìš”</span>
              </div>
            </div>
          </div>

          <!-- ê¸°ë¶„ -->
          <div class="section">
            <div class="card pad" style="background: rgba(255,235,244,.78); border-color: rgba(226,67,88,.12);">
              <div style="display:flex;align-items:center;gap:10px;font-weight:900;">
                <span class="pill" style="background: rgba(226,67,88,.10); color:#9d174d; border-color: rgba(226,67,88,.18);">â¤</span>
                <span data-i18n="mood">ê¸°ë¶„ & ì»¨ë””ì…˜</span>
              </div>

              <div class="note" style="margin-top:10px" data-i18n="mood_q">ì˜¤ëŠ˜ ê¸°ë¶„ì€ ì–´ë– ì„¸ìš”?</div>

              <div class="row cols-3" style="margin-top:10px">
                <label class="mini card soft mood-card" style="padding:12px; text-align:center; cursor:pointer;">
                  <div style="font-size:22px">ğŸ˜Š</div>
                  <div style="margin-top:6px; font-weight:900" data-i18n="mood_best">ìµœê³ </div>
                  <input type="radio" name="mood" value="best" style="display:none"/>
                </label>
                <label class="mini card soft mood-card" style="padding:12px; text-align:center; cursor:pointer;">
                  <div style="font-size:22px">ğŸ˜</div>
                  <div style="margin-top:6px; font-weight:900" data-i18n="mood_ok">ë³´í†µ</div>
                  <input type="radio" name="mood" value="ok" checked style="display:none"/>
                </label>
                <label class="mini card soft mood-card" style="padding:12px; text-align:center; cursor:pointer;">
                  <div style="font-size:22px">ğŸ˜´</div>
                  <div style="margin-top:6px; font-weight:900" data-i18n="mood_tired">í”¼ê³¤</div>
                  <input type="radio" name="mood" value="tired" style="display:none"/>
                </label>
              </div>

              <div id="moodNote" class="note" style="margin-top:8px; font-size:12px; color:var(--muted);">
                ì˜¤ëŠ˜ ê¸°ë¶„ë„ í•¨ê»˜ ê¸°ë¡í•´ë‘˜ê²Œìš”.
              </div>
            </div>
          </div>

          <!-- ë¬¼ -->
          <div class="section">
            <div class="card pad" style="background: rgba(236,253,245,.9); border-color: rgba(22,163,74,.15);">
              <div style="display:flex;align-items:center;gap:10px;font-weight:900;">
                <span class="pill" style="background: rgba(22,163,74,.08); color:#166534; border-color: rgba(22,163,74,.22);">ğŸ’§</span>
                <span data-i18n="water_title">ë¬¼ ì„­ì·¨</span>
              </div>

              <div class="water-row">
                <button type="button" class="water-btn" id="waterMinus">âˆ’</button>

                <div class="water-dots">
                  <!-- 20 dots = 0.1L â†’ 2.0L -->
                  <div class="water-dot" data-water-dot="1"></div>
                  <div class="water-dot" data-water-dot="2"></div>
                  <div class="water-dot" data-water-dot="3"></div>
                  <div class="water-dot" data-water-dot="4"></div>
                  <div class="water-dot" data-water-dot="5"></div>
                  <div class="water-dot" data-water-dot="6"></div>
                  <div class="water-dot" data-water-dot="7"></div>
                  <div class="water-dot" data-water-dot="8"></div>
                  <div class="water-dot" data-water-dot="9"></div>
                  <div class="water-dot" data-water-dot="10"></div>
                  <div class="water-dot" data-water-dot="11"></div>
                  <div class="water-dot" data-water-dot="12"></div>
                  <div class="water-dot" data-water-dot="13"></div>
                  <div class="water-dot" data-water-dot="14"></div>
                  <div class="water-dot" data-water-dot="15"></div>
                  <div class="water-dot" data-water-dot="16"></div>
                  <div class="water-dot" data-water-dot="17"></div>
                  <div class="water-dot" data-water-dot="18"></div>
                  <div class="water-dot" data-water-dot="19"></div>
                  <div class="water-dot" data-water-dot="20"></div>
                </div>

                <button type="button" class="water-btn" id="waterPlus">+</button>
              </div>
              <div class="water-label" id="waterLabel">
                <span id="waterCurrentLiters">0.0</span> L (
                <span id="waterCupsCount">0</span>
                <span id="waterCupsUnit" data-i18n="water_cups_unit">ì”</span>
                ) / <span id="waterGoalLiters">2.0</span> L
              </div>
            </div>
          </div>

          <!-- ì €ì¥ ë²„íŠ¼ -->
          <div class="section">
            <button class="btn" id="saveTrackerBtn" data-i18n="save_today">ì˜¤ëŠ˜ì˜ ë°ì´í„° ì €ì¥í•˜ê¸°</button>
          </div>

          <!-- ì—ë„ˆì§€ vs ì˜ì–‘ -->
          <div class="section">
            <div class="card pad">
              <div style="display:flex;align-items:flex-start;gap:10px;">
                <span class="pill">ğŸ“ˆ</span>
                <div>
                  <div style="font-weight:900" data-i18n="chart_title">ì—ë„ˆì§€ vs ì˜ì–‘ ì ìˆ˜</div>
                  <div style="color:var(--muted); font-size:13px" data-i18n="chart_sub">ì‹ì‚¬ í’ˆì§ˆê³¼ ì—ë„ˆì§€ ìˆ˜ì¤€ì˜ ìƒê´€ê´€ê³„</div>
                </div>
              </div>

              <div class="chart-box" id="chartBox">
                <svg viewBox="0 0 320 170" width="100%" height="170" aria-label="Chart">
                  <path d="M20 20V150H310" stroke="rgba(31,34,48,.18)" fill="none"/>
                  <g fill="none" stroke="rgba(31,34,48,.10)">
                    <path d="M20 40H310"/><path d="M20 70H310"/><path d="M20 100H310"/><path d="M20 130H310"/>
                  </g>

                  <!-- energy line -->
                  <path d="M20 70 L65 60 L110 95 L155 65 L200 100 L245 70 L290 60"
                        stroke="rgba(91,91,214,.85)" stroke-width="3" fill="none"/>
                  <g fill="rgba(91,91,214,.85)">
                    <circle cx="20" cy="70" r="4"/><circle cx="65" cy="60" r="4"/><circle cx="110" cy="95" r="4"/>
                    <circle cx="155" cy="65" r="4"/><circle cx="200" cy="100" r="4"/><circle cx="245" cy="70" r="4"/><circle cx="290" cy="60" r="4"/>
                  </g>

                  <!-- nutrition line -->
                  <path d="M20 55 L65 45 L110 70 L155 35 L200 65 L245 55 L290 50"
                        stroke="rgba(226,67,88,.85)" stroke-width="3" fill="none"/>
                  <g fill="rgba(226,67,88,.85)">
                    <circle cx="20" cy="55" r="4"/><circle cx="65" cy="45" r="4"/><circle cx="110" cy="70" r="4"/>
                    <circle cx="155" cy="35" r="4"/><circle cx="200" cy="65" r="4"/><circle cx="245" cy="55" r="4"/><circle cx="290" cy="50" r="4"/>
                  </g>

                  <g font-size="10" fill="rgba(31,34,48,.55)">
                    <text x="16" y="164">ì›”</text><text x="61" y="164">í™”</text><text x="106" y="164">ìˆ˜</text>
                    <text x="151" y="164">ëª©</text><text x="196" y="164">ê¸ˆ</text><text x="241" y="164">í† </text><text x="286" y="164">ì¼</text>
                  </g>
                </svg>

                <!-- hover hit ì˜ì—­ -->
                <div class="chart-hit" data-day="0" style="left:0%;"></div>
                <div class="chart-hit" data-day="1" style="left:14.285%;"></div>
                <div class="chart-hit" data-day="2" style="left:28.57%;"></div>
                <div class="chart-hit" data-day="3" style="left:42.855%;"></div>
                <div class="chart-hit" data-day="4" style="left:57.14%;"></div>
                <div class="chart-hit" data-day="5" style="left:71.425%;"></div>
                <div class="chart-hit" data-day="6" style="left:85.71%;"></div>

                <div id="chartTooltip" class="chart-tooltip hidden">
                  <div class="chart-tooltip-title">Mon</div>
                  <div class="chart-tooltip-row">
                    <span class="chart-tooltip-label">Energy</span>
                    <span id="ttEnergyValue">80 / 100</span>
                  </div>
                  <div class="chart-tooltip-row">
                    <span class="chart-tooltip-label">Nutrition</span>
                    <span id="ttNutriValue">82 / 100</span>
                  </div>
                </div>
              </div>

			  <div class="row cols-1" style="margin-top:10px; gap:10px;">
			    <div class="card pad soft">
			      <div style="color:var(--muted); font-size:12px" data-i18n="avg_energy">í‰ê·  ì—ë„ˆì§€</div>
			      <div style="font-size:22px; font-weight:900; color:#3b3fb6;">77%</div>
			    </div>
			    <div class="card pad soft" style="background: rgba(255,235,244,.78);">
			      <div style="color:var(--muted); font-size:12px" data-i18n="avg_nutri">í‰ê·  ì˜ì–‘</div>
			      <div style="font-size:22px; font-weight:900; color:#db2777;">86%</div>
			    </div>
			    <div class="card pad soft" style="background: rgba(236,255,244,.85);">
			      <div style="color:var(--muted); font-size:12px" data-i18n="corr">ìƒê´€ë„</div>
			      <div style="font-size:20px; font-weight:900; color:#166534;" data-i18n="corr_high">ë†’ìŒ</div>
			    </div>
			  </div>
            </div>
          </div>

          <!-- ë‹¬ë ¥ -->
          <div class="section">
            <div class="card pad">
              <div class="calendar-header">
                <button type="button" class="calendar-nav-btn" id="prevMonthBtn">â€¹</button>
                <div class="calendar-title" id="calendarMonthLabel">2026ë…„ 1ì›”</div>
                <button type="button" class="calendar-nav-btn" id="nextMonthBtn">â€º</button>
              </div>

              <div class="calendar-weekdays" id="calendarWeekdays">
                <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
              </div>

              <div id="calendarGrid" class="calendar-grid"></div>

              <div class="calendar-legend">
                <span class="dot"></span>
                <span data-i18n="calendar_legend">ìƒ‰ì´ ìˆëŠ” ë‚ ì§œëŠ” ê¸°ë¡ì´ ìˆëŠ” ë‚ ì´ì—ìš”.</span>
              </div>
            </div>
          </div>
		  
		  <!-- í•˜ë£¨ ìš”ì•½ ì¹´ë“œ (ë‹¬ë ¥ ì•„ë˜) -->
		  <div class="section" id="daySummarySection" style="display:none;">
		    <div class="card pad day-summary-card" id="daySummaryCard">
		      <div class="day-summary-header">
		        <span class="day-summary-title" data-i18n="summary_title">í•˜ë£¨ ê¸°ë¡ ìš”ì•½</span>
		        <span class="day-summary-date" id="summaryDate">2026-01-07</span>
		      </div>

		      <dl class="day-summary-list" id="summaryContent">
		        <!-- JSì—ì„œ ì±„ì›Œì§ -->
		      </dl>

		      <div class="day-summary-comment" id="summaryComment"></div>
		    </div>
		  </div>


          <!-- ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìˆìœ¼ë©´ ë³´í˜¸ -->
          <script>
            (function () {
              var uid = localStorage.getItem("userId");
              if (!uid) {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                window.location.href = "./login.html";
              }
            })();
          </script>

        </div>
      </div>
    </main>

    <!-- bottom nav -->
    <nav class="bottom-nav" aria-label="Bottom Navigation">
      <a class="nav-item" data-nav="home" href="./home.html">
        <div class="dot">
          <svg viewBox="0 0 24 24"><path d="M12 3l9 8h-3v10h-5v-6H11v6H6V11H3l9-8z"/></svg>
        </div>
        <div data-i18n="nav_home">í™ˆ</div>
      </a>
      <a class="nav-item" data-nav="plan" href="./planner.html">
        <div class="dot">
          <svg viewBox="0 0 24 24"><path d="M7 2h2v2h6V2h2v2h3v18H4V4h3V2zm13 6H6v12h14V8z"/></svg>
        </div>
        <div data-i18n="nav_plan">ê³„íš</div>
      </a>
      <a class="nav-item" data-nav="tracker" href="./tracker.html">
        <div class="dot">
          <svg viewBox="0 0 24 24"><path d="M3 13h4l2-6 4 14 3-9h5v2h-4z"/></svg>
        </div>
        <div data-i18n="nav_tracker">íŠ¸ë˜ì»¤</div>
      </a>
      <a class="nav-item" data-nav="profile" href="./profile.html">
        <div class="dot">
          <svg viewBox="0 0 24 24"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-4.4 0-8 2.2-8 5v3h16v-3c0-2.8-3.6-5-8-5z"/></svg>
        </div>
        <div data-i18n="nav_profile">í”„ë¡œí•„</div>
      </a>
    </nav>
  </div>

  <!-- ê³µí†µ ì•± ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="../assets/app.js"></script>
  <script>
    HM.setActiveNav("tracker");
    HM.ensureSession();
  </script>

  <!-- íŠ¸ë˜ì»¤ ì „ìš© ë¡œì§ -->
  <script>
    const API_BASE = "";
    const userId   = Number(localStorage.getItem("userId"));

    const sleepInput   = document.getElementById("sleep");
    const sleepLabel   = document.getElementById("sleepLabel");
    const sleepNote    = document.getElementById("sleepNote");
    const sleepReaction= document.getElementById("sleepReaction");
    const moodInputs   = document.querySelectorAll('input[name="mood"]');
    const saveBtn      = document.getElementById("saveTrackerBtn");
    const moodCards    = document.querySelectorAll(".mood-card");
    const moodNoteEl   = document.getElementById("moodNote");

    // í‰ê· /ìƒê´€ë„
    const avgEnergyEl = document.getElementById("avgEnergyValue");
    const avgNutriEl  = document.getElementById("avgNutriValue");
    const corrTextEl  = document.getElementById("corrText");

    // ë¬¼
    const waterMinusBtn = document.getElementById("waterMinus");
    const waterPlusBtn  = document.getElementById("waterPlus");
    const waterDots     = document.querySelectorAll(".water-dot");
    const waterCurrentLitersEl = document.getElementById("waterCurrentLiters");
    const waterCupsCountEl     = document.getElementById("waterCupsCount");
    const waterCupsUnitEl      = document.getElementById("waterCupsUnit");
    const waterGoalLitersEl    = document.getElementById("waterGoalLiters");
    const WATER_GOAL           = 20; // 0.1L step â†’ 2.0 L
    let waterCount             = 0;

    // ê·¸ë˜í”„
    const chartBox   = document.getElementById("chartBox");
    const tooltipEl  = document.getElementById("chartTooltip");
    const ttEnergyEl = document.getElementById("ttEnergyValue");
    const ttNutriEl  = document.getElementById("ttNutriValue");
    const hitAreas   = document.querySelectorAll(".chart-hit");

    const weekData = {
      energy:   [78, 82, 70, 95, 88, 80, 76],
      nutrition:[80, 79, 72, 90, 86, 83, 79]
    };

    // ë‹¬ë ¥
    const calendarGrid = document.getElementById("calendarGrid");
    const monthLabelEl = document.getElementById("calendarMonthLabel");
    const prevMonthBtn = document.getElementById("prevMonthBtn");
    const nextMonthBtn = document.getElementById("nextMonthBtn");
    const weekdaysRow  = document.getElementById("calendarWeekdays");

    const today = new Date();
    let currentYear  = today.getFullYear();
    let currentMonth = today.getMonth() + 1; // 1~12
    let selectedCell = null;
	let lastSelectedDateStr = null; 

    function pad2(n){ return n < 10 ? "0"+n : ""+n; }

    // ì–¸ì–´ ì½”ë“œ ê°€ì ¸ì˜¤ê¸° (HM.getLang ìš°ì„ )
    function getCurrentLang() {
      if (window.HM && typeof HM.getLang === "function") {
        return HM.getLang();
      }
      return (localStorage.getItem("hm_lang") || "ko").toLowerCase();
    }

    // ê¸°ë¶„ ë©”ì‹œì§€ ì‚¬ì „
    const MOOD_MSG_DICT = (window.HM && HM.MOOD_MSG_I18N) ? HM.MOOD_MSG_I18N : {
      best: {
        ko: "ì˜¤ëŠ˜ ê¸°ë¶„ ìµœê³ ë„¤ìš”! ì´ëŸ° ë‚ ì˜ ì‹ì‚¬ íŒ¨í„´ë„ í•¨ê»˜ ê¸°ë¡í•´ë‘ë©´ ì¢‹ì•„ìš”.",
        en: "Youâ€™re feeling great today! Itâ€™s a good idea to log your meals on days like this.",
        ru: "Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ñƒ Ğ²Ğ°Ñ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ! ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ğ¾ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹ ĞµĞ´Ğ¸Ñ‚Ğµ Ğ² Ñ‚Ğ°ĞºĞ¸Ğµ Ğ´Ğ½Ğ¸."
      },
      ok: {
        ko: "ë³´í†µ ì»¨ë””ì…˜ì´ì—ìš”. ë©°ì¹  ê°„ì˜ íë¦„ì„ í•¨ê»˜ ë³´ëŠ” ê²Œ ì¤‘ìš”í•´ìš”.",
        en: "Youâ€™re feeling okay. Itâ€™s important to look at the pattern over several days.",
        ru: "ĞĞ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ. Ğ’Ğ°Ğ¶Ğ½Ğ¾ ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ½Ğ° Ğ¾Ğ±Ñ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ·Ğ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹."
      },
      tired: {
        ko: "ì¡°ê¸ˆ í”¼ê³¤í•œ í•˜ë£¨ì˜€ì–´ìš”. ìˆ˜ë©´Â·ìˆ˜ë¶„ ìƒíƒœë¥¼ ê°™ì´ ë³´ë©´ì„œ íŒ¨í„´ì„ ì°¾ì•„ë³¼ê¹Œìš”?",
        en: "Youâ€™re a bit tired today. Letâ€™s check your sleep and water intake together.",
        ru: "Ğ¡ĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ²Ñ‹ Ğ½ĞµĞ¼Ğ½Ğ¾Ğ³Ğ¾ ÑƒÑÑ‚Ğ°Ğ»Ğ¸. Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ Ğ²Ğ¼ĞµÑÑ‚Ğµ Ğ½Ğ° ÑĞ¾Ğ½ Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ğ¾Ğ´Ñ‹."
      }
    };

    // ìˆ˜ë©´ ë©”ì‹œì§€ ì‚¬ì „ (ì¢‹ìŒ/ë³´í†µ/ë¶€ì¡±)
    const SLEEP_MSG_DICT = {
      good: {
        ko: "í‘¹ ì˜ ì¤ì–´ìš”! ì˜¤ëŠ˜ë„ ì¢‹ì€ ì»¨ë””ì…˜ì„ ê¸°ëŒ€í•´ë³¼ ìˆ˜ ìˆì–´ìš”.",
        en: "You slept well! You can expect good energy today.",
        ru: "Ğ’Ñ‹ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ²Ñ‹ÑĞ¿Ğ°Ğ»Ğ¸ÑÑŒ! ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ñ‚ÑŒ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞµĞµ ÑĞ°Ğ¼Ğ¾Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¸Ğµ."
      },
      mid: {
        ko: "ë‚˜ì˜ì§€ ì•Šì€ ìˆ˜ë©´ì´ì—ìš”. ë‚´ì¼ì€ ì¡°ê¸ˆ ë” ê·œì¹™ì ìœ¼ë¡œ ìë³´ëŠ” ê±´ ì–´ë•Œìš”?",
        en: "Your sleep was okay. Maybe try a more regular schedule tomorrow.",
        ru: "Ğ¡Ğ¾Ğ½ Ğ±Ñ‹Ğ» Ğ½ĞµĞ¿Ğ»Ğ¾Ñ…Ğ¸Ğ¼. ĞœĞ¾Ğ¶ĞµÑ‚, Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ° Ğ»ĞµÑ‡ÑŒ Ğ¿Ğ¾Ñ€Ğ°Ğ½ÑŒÑˆĞµ?"
      },
      bad: {
        ko: "ìˆ˜ë©´ì´ ë§ì´ ë¶€ì¡±í•´ìš”. ì˜¤ëŠ˜ì€ ì¹´í˜ì¸ì„ ì¤„ì´ê³ , ì¼ì° ì‰¬ëŠ” ê²Œ ì¢‹ì•„ìš”.",
        en: "Sleep was quite short. Try to rest early and go easy on caffeine today.",
        ru: "Ğ’Ñ‹ Ğ¼Ğ°Ğ»Ğ¾ ÑĞ¿Ğ°Ğ»Ğ¸. Ğ›ÑƒÑ‡ÑˆĞµ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ Ğ»ĞµÑ‡ÑŒ Ğ¿Ğ¾Ñ€Ğ°Ğ½ÑŒÑˆĞµ Ğ¸ Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ±Ğ°Ñ€Ñ‰Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ ĞºĞ¾Ñ„ĞµĞ¸Ğ½Ğ¾Ğ¼."
      }
    };

    // ë¬¼ ë Œë”
    function renderWater() {
      waterDots.forEach((dot, idx) => {
        const n = idx + 1;
        dot.classList.toggle("filled", n <= waterCount);
      });

      const liters = (waterCount * 0.1).toFixed(1);
      const goalL  = (WATER_GOAL * 0.1).toFixed(1);
      const cups   = waterCount;

      if (waterCurrentLitersEl) waterCurrentLitersEl.textContent = liters;
      if (waterCupsCountEl)     waterCupsCountEl.textContent     = cups;
      if (waterGoalLitersEl)    waterGoalLitersEl.textContent    = goalL;

      // ë‹¨ìœ„ëŠ” app.jsì˜ water_cups_unit í™œìš©
      let unitText = "ì”";
      if (window.HM && typeof HM.t === "function") {
        unitText = HM.t("water_cups_unit");
      } else {
        const lang = getCurrentLang();
        if (lang === "en") unitText = "cups";
        else if (lang === "ru") unitText = "ÑÑ‚Ğ°ĞºĞ°Ğ½(Ğ¾Ğ²)";
      }
      if (waterCupsUnitEl) {
        waterCupsUnitEl.textContent = unitText;
      }

      waterMinusBtn.disabled = (waterCount === 0);
      waterPlusBtn.disabled  = (waterCount === WATER_GOAL);
    }

    if (waterMinusBtn) {
      waterMinusBtn.addEventListener("click", () => {
        if (waterCount > 0) {
          waterCount -= 1;
          renderWater();
        }
      });
    }
    if (waterPlusBtn) {
      waterPlusBtn.addEventListener("click", () => {
        if (waterCount < WATER_GOAL) {
          waterCount += 1;
          renderWater();
        }
      });
    }

    // ìˆ˜ë©´ UI ì—…ë°ì´íŠ¸ (ë¼ë²¨ + ìƒ‰ + ë©”ì‹œì§€)
    function updateSleepUI(hours) {
      if (sleepLabel) {
        sleepLabel.textContent = `${hours}ì‹œê°„`;
      }
      if (!sleepNote || !sleepReaction) return;

      sleepNote.classList.remove("sleep-good","sleep-mid","sleep-bad");

      let level = "mid";
      if (hours >= 7 && hours <= 9) {
        level = "good";
        sleepNote.classList.add("sleep-good");
      } else if (hours <= 4) {
        level = "bad";
        sleepNote.classList.add("sleep-bad");
      } else {
        level = "mid";
        sleepNote.classList.add("sleep-mid");
      }

      const lang = getCurrentLang();
      const dict = SLEEP_MSG_DICT[level];
      let msg = dict ? (dict[lang] || dict["ko"]) : "";
      sleepReaction.textContent = msg;
    }

    if (sleepInput) {
      sleepInput.addEventListener("input", () => {
        const v = Number(sleepInput.value || "0");
        updateSleepUI(v);
      });
    }

    // ê¸°ë¶„ UI
    function updateMoodUI(mood) {
      moodCards.forEach(card => {
        const input = card.querySelector('input[name="mood"]');
        const isCurrent = input.value === mood;
        input.checked = isCurrent;
        card.classList.toggle("selected", isCurrent);
      });

      if (!moodNoteEl) return;

      const lang = getCurrentLang();
      const dict = MOOD_MSG_DICT[mood] || MOOD_MSG_DICT["ok"];
      const msg  = (dict && dict[lang]) || dict["ko"] || "";
      moodNoteEl.textContent = msg;
    }

    moodCards.forEach(card => {
      card.addEventListener("click", () => {
        const input = card.querySelector('input[name="mood"]');
        if (input) {
          updateMoodUI(input.value);
        }
      });
    });

    // ê·¸ë˜í”„ íˆ´íŒ ìš”ì¼
    const TOOLTIP_DOWS = {
      ko: ["ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† ","ì¼"],
      en: ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
      ru: ["ĞŸĞ½","Ğ’Ñ‚","Ğ¡Ñ€","Ğ§Ñ‚","ĞŸÑ‚","Ğ¡Ğ±","Ğ’Ñ"]
    };

    function showTooltip(dayIndex, clientX){
      if (!tooltipEl) return;
      const lang = getCurrentLang();
      const dows = TOOLTIP_DOWS[lang] || TOOLTIP_DOWS["ko"];
      const label = dows[dayIndex] || dows[0];

      tooltipEl.querySelector(".chart-tooltip-title").textContent = label;
      ttEnergyEl.textContent = weekData.energy[dayIndex]  + " / 100";
      ttNutriEl.textContent  = weekData.nutrition[dayIndex] + " / 100";

      const boxRect = chartBox.getBoundingClientRect();
      const x = clientX - boxRect.left;
      tooltipEl.style.left = x + "px";
      tooltipEl.style.top  = "20px";
      tooltipEl.classList.remove("hidden");
    }

    hitAreas.forEach(area=>{
      area.addEventListener("mouseenter", e=>{
        const day = Number(area.dataset.day || "0");
        showTooltip(day, e.clientX);
      });
      area.addEventListener("mousemove", e=>{
        const day = Number(area.dataset.day || "0");
        showTooltip(day, e.clientX);
      });
      area.addEventListener("mouseleave", ()=>{
        tooltipEl.classList.add("hidden");
      });
    });

    // ë‹¬ë ¥ i18n
    const CAL_I18N = {
      ko: {
        dows:["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "],
        months:["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"]
      },
      en: {
        dows:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],
        months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
      },
      ru: {
        dows:["Ğ’Ñ","ĞŸĞ½","Ğ’Ñ‚","Ğ¡Ñ€","Ğ§Ñ‚","ĞŸÑ‚","Ğ¡Ğ±"],
        months:["Ğ¯Ğ½Ğ²","Ğ¤ĞµĞ²","ĞœĞ°Ñ€","ĞĞ¿Ñ€","ĞœĞ°Ğ¹","Ğ˜ÑĞ½","Ğ˜ÑĞ»","ĞĞ²Ğ³","Ğ¡ĞµĞ½","ĞĞºÑ‚","ĞĞ¾Ğ²","Ğ”ĞµĞº"]
      }
    };

    function renderWeekdays(){
      if (!weekdaysRow) return;
      const lang = getCurrentLang();
      const dows = (CAL_I18N[lang] || CAL_I18N["ko"]).dows;
      const children = weekdaysRow.children;
      for(let i=0;i<7;i++){
        if (children[i]) children[i].textContent = dows[i];
      }
    }

    async function loadCalendarMonth(){
      try{
        const res = await fetch(`${API_BASE}/api/tracker/month?userId=${userId}&year=${currentYear}&month=${currentMonth}`);
        const data = await res.json();
        const days = data.days || [];

        const map = {};
        days.forEach(d=>{ map[d.date] = d.hasEntry; });

        const lang  = getCurrentLang();
        const monthName = (CAL_I18N[lang] || CAL_I18N["ko"]).months[currentMonth-1];
        if (lang === "ko")      monthLabelEl.textContent = `${currentYear}ë…„ ${monthName}`;
        else if (lang === "ru") monthLabelEl.textContent = `${monthName} ${currentYear} Ğ³.`;
        else                    monthLabelEl.textContent = `${monthName} ${currentYear}`;

        renderWeekdays();

        const first = new Date(currentYear, currentMonth - 1, 1);
        const firstWeekday = first.getDay(); // 0(ì¼)~6(í† )
        const lastDay = new Date(currentYear, currentMonth, 0).getDate();

        calendarGrid.innerHTML = "";
        selectedCell = null;

        for(let i=0;i<firstWeekday;i++){
          const cell = document.createElement("div");
          cell.className = "calendar-cell empty";
          calendarGrid.appendChild(cell);
        }

        for(let d=1; d<=lastDay; d++){
          const cell = document.createElement("div");
          const dateStr = `${currentYear}-${pad2(currentMonth)}-${pad2(d)}`;
          const hasEntry = !!map[dateStr];

          cell.textContent = d;
          cell.className = "calendar-cell";
          if (hasEntry) cell.classList.add("has-entry");

          if (currentYear===today.getFullYear() && currentMonth===(today.getMonth()+1) && d===today.getDate()){
            cell.classList.add("today");
          }

          cell.addEventListener("click", ()=>{
            if (selectedCell) selectedCell.classList.remove("selected");
            selectedCell = cell;
            cell.classList.add("selected");
            loadDay(dateStr);
          });

          calendarGrid.appendChild(cell);
        }
      }catch(err){
        console.error(err);
      }
    }

	async function loadDay(dateStr){
	  try{
	    // ğŸ”¹ ë§ˆì§€ë§‰ìœ¼ë¡œ ì„ íƒí•œ ë‚ ì§œ ê¸°ì–µ
	    lastSelectedDateStr = dateStr;

	    const res = await fetch(`${API_BASE}/api/tracker/day?userId=${userId}&date=${dateStr}`);
	    const data = await res.json();

	    // ê¸°ë¡ì´ ì—†ëŠ” ë‚ ì§œì¸ ê²½ìš°
	    if (!data.hasEntry || !data.entry){
	      // ìš”ì•½ ì¹´ë“œ: "ê¸°ë¡ ì—†ìŒ" í‘œì‹œ
	      renderSummary(dateStr, null);

	      // ë©”ì¸ íŠ¸ë˜ì»¤ UI ê¸°ë³¸ê°’ (ì§€ê¸ˆ ë¡œì§ ìœ ì§€)
	      const defaultSleep = 7;
	      if (sleepInput) {
	        sleepInput.value = defaultSleep;
	        updateSleepUI(defaultSleep);
	      }
	      updateMoodUI("ok");
	      waterCount = 0;
	      renderWater();
	      return;
	    }

	    // ê¸°ë¡ì´ ìˆëŠ” ë‚ ì§œ
	    const entry = data.entry;

	    // ë©”ì¸ íŠ¸ë˜ì»¤ UI (ê¸°ì¡´ ë¡œì§ ê·¸ëŒ€ë¡œ)
	    if (entry.sleepHours != null && sleepInput){
	      sleepInput.value = entry.sleepHours;
	      updateSleepUI(entry.sleepHours);
	    }
	    if (entry.mood) {
	      updateMoodUI(entry.mood);
	    } else {
	      updateMoodUI("ok");
	    }
	    if (entry.waterGlasses != null){
	      waterCount = Math.max(0, Math.min(WATER_GOAL, entry.waterGlasses));
	      renderWater();
	    }

	    // ğŸ”¹ ìš”ì•½ ì¹´ë“œë„ í•¨ê»˜ ê°±ì‹ 
	    renderSummary(dateStr, entry);

	  }catch(err){
	    console.error(err);
	  }
	}



    async function loadSummary(){
      try{
        const res = await fetch(`${API_BASE}/api/tracker/summary/${userId}`);
        const data = await res.json();
        if (!data.success) return;
        if (avgEnergyEl && data.energyScore != null){
          avgEnergyEl.textContent = data.energyScore + "%";
        }
        if (avgNutriEl && data.nutritionScore != null){
          avgNutriEl.textContent  = data.nutritionScore + "%";
        }
        if (corrTextEl && data.correlation){
          let textKey = "corr_high";
          if (data.correlation==="MID") textKey = "corr_mid";
          else if (data.correlation==="LOW") textKey = "corr_low";

          // ê¸°ë³¸ í•œêµ­ì–´ í…ìŠ¤íŠ¸
          let text = "ë†’ìŒ";
          if (data.correlation==="MID") text = "ë³´í†µ";
          else if (data.correlation==="LOW") text = "ë‚®ìŒ";

          corrTextEl.textContent = text;
        }
      }catch(err){
        console.error(err);
      }
    }

    // ì €ì¥ ë²„íŠ¼ â†’ ë°±ì—”ë“œ ì €ì¥
    if (saveBtn) {
      saveBtn.addEventListener("click", async (e)=>{
        e.preventDefault();
        const sleepHours = sleepInput ? Number(sleepInput.value || "0") : 0;
        const moodEl = Array.from(moodInputs).find(m=>m.checked);
        const mood   = moodEl ? moodEl.value : "ok";

        try{
          const res = await fetch(`${API_BASE}/api/tracker`,{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
              userId,
              sleepHours,
              mood,
              waterGlasses: waterCount
            })
          });

          const data = await res.json();
          if (!data.success){
            alert(data.message || "ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            return;
          }
          alert("ì˜¤ëŠ˜ì˜ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
          await loadSummary();
          await loadCalendarMonth();
        }catch(err){
          console.error(err);
          alert("ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      });
    }

    // ë‹¬ë ¥ ì›” ì´ë™
    if (prevMonthBtn) {
      prevMonthBtn.addEventListener("click", ()=>{
        currentMonth--;
        if (currentMonth === 0){
          currentMonth = 12;
          currentYear--;
        }
        loadCalendarMonth();
      });
    }
    if (nextMonthBtn) {
      nextMonthBtn.addEventListener("click", ()=>{
        currentMonth++;
        if (currentMonth === 13){
          currentMonth = 1;
          currentYear++;
        }
        loadCalendarMonth();
      });
    }

    // ì–¸ì–´ ë²„íŠ¼ ëˆ„ë¥¼ ë•Œ: app.jsê°€ ì–¸ì–´ ë°”ê¾¼ ë’¤ ë¬¼/ê¸°ë¶„/ë‹¬ë ¥/ìˆ˜ë©´ ë‹¤ì‹œ ë Œë”
	document.querySelectorAll("[data-set-lang]").forEach(btn=>{
	  btn.addEventListener("click", ()=>{
	    setTimeout(()=>{
	      const moodEl = Array.from(moodInputs).find(m => m.checked);
	      updateMoodUI(moodEl ? moodEl.value : "ok");
	      renderWater();
	      const currentSleep = sleepInput ? Number(sleepInput.value || "7") : 7;
	      updateSleepUI(currentSleep);
	      loadCalendarMonth();

	      // ğŸ”¹ ìš”ì•½ ì¹´ë“œë„ í˜„ì¬ ì–¸ì–´ì— ë§ê²Œ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
	      const dateStr = lastSelectedDateStr
	        ? lastSelectedDateStr
	        : `${today.getFullYear()}-${pad2(today.getMonth()+1)}-${pad2(today.getDate())}`;
	      loadDay(dateStr);
	    }, 80);
	  });
	});

	// í•˜ë£¨ ìš”ì•½ ì¹´ë“œ ë Œë” (ì´ëª¨ì§€ ì—†ì´, í…ìŠ¤íŠ¸ë§Œ)
	// í•˜ë£¨ ìš”ì•½ ì¹´ë“œ ë Œë” (ë©”ì‹œì§€ ì—†ì´, ë‹¤êµ­ì–´ ì§€ì›)
	function renderSummary(dateStr, entry){
	  const section   = document.getElementById("daySummarySection");
	  const dateEl    = document.getElementById("summaryDate");
	  const contentEl = document.getElementById("summaryContent");
	  const commentEl = document.getElementById("summaryComment");

	  if (!section || !dateEl || !contentEl || !commentEl) return;

	  // ì¹´ë“œ ë³´ì´ê²Œ
	  section.style.display = "block";
	  dateEl.textContent = dateStr;

	  const lang = getCurrentLang();

	  // ê³µí†µ í…ìŠ¤íŠ¸ ë„ìš°ë¯¸
	  function textNoRecord(){
	    if (lang === "en") return "No record";
	    if (lang === "ru") return "ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…";
	    return "ê¸°ë¡ ì—†ìŒ";
	  }

	  function textNoDataForDay(){
	    if (lang === "en") return "No data has been recorded for this day yet.";
	    if (lang === "ru") return "Ğ’ ÑÑ‚Ğ¾Ñ‚ Ğ´ĞµĞ½ÑŒ Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹.";
	    return "ì•„ì§ ì´ ë‚ ì€ ê¸°ë¡ì´ ì—†ì–´ìš”.";
	  }

	  function labelSleep(){
	    if (lang === "en") return "Sleep";
	    if (lang === "ru") return "Ğ¡Ğ¾Ğ½";
	    return "ìˆ˜ë©´";
	  }
	  function labelMood(){
	    if (lang === "en") return "Mood";
	    if (lang === "ru") return "ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ";
	    return "ê¸°ë¶„";
	  }
	  function labelWater(){
	    if (lang === "en") return "Water";
	    if (lang === "ru") return "Ğ’Ğ¾Ğ´Ğ°";
	    return "ë¬¼";
	  }

	  function moodTextByCode(code){
	    if (!code) return textNoRecord();
	    if (lang === "en"){
	      if (code === "best")  return "Very good";
	      if (code === "ok")    return "Normal";
	      if (code === "tired") return "Tired";
	    } else if (lang === "ru"){
	      if (code === "best")  return "ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾";
	      if (code === "ok")    return "ĞĞ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾";
	      if (code === "tired") return "Ğ£ÑÑ‚Ğ°Ğ»Ğ¾";
	    } else {
	      if (code === "best")  return "ìµœê³ ";
	      if (code === "ok")    return "ë³´í†µ";
	      if (code === "tired") return "í”¼ê³¤";
	    }
	    return code;
	  }

	  // ğŸ”¹ ê¸°ë¡ì´ ì—†ì„ ë•Œ
	  if (!entry){
	    contentEl.innerHTML = `
	      <div style="font-size:12px; text-align:center;">
	        ${textNoDataForDay()}
	      </div>
	    `;
	    commentEl.textContent = "";   // ë©”ì‹œì§€ ì™„ì „ ì œê±°
	    return;
	  }

	  // ğŸ”¹ ìˆ˜ë©´ í…ìŠ¤íŠ¸
	  let sleepText;
	  if (entry.sleepHours != null){
	    if (lang === "en")      sleepText = `${entry.sleepHours} h`;
	    else if (lang === "ru") sleepText = `${entry.sleepHours} Ñ‡`;
	    else                    sleepText = `${entry.sleepHours}ì‹œê°„`;
	  } else {
	    sleepText = textNoRecord();
	  }

	  // ğŸ”¹ ê¸°ë¶„ í…ìŠ¤íŠ¸
	  const moodText = moodTextByCode(entry.mood);

	  // ğŸ”¹ ë¬¼ í…ìŠ¤íŠ¸
	  let waterText;
	  if (entry.waterGlasses != null){
	    const liters = (entry.waterGlasses * 0.1).toFixed(1);
	    if (lang === "en"){
	      waterText = `${liters} L (${entry.waterGlasses} cups)`;
	    } else if (lang === "ru"){
	      waterText = `${liters} Ğ» (${entry.waterGlasses} ÑÑ‚Ğ°ĞºĞ°Ğ½(Ğ¾Ğ²))`;
	    } else {
	      waterText = `${liters}L (${entry.waterGlasses}ì”)`;
	    }
	  } else {
	    waterText = textNoRecord();
	  }

	  // ğŸ”¹ ì´ëª¨ì§€ ì—†ì´, ë¼ë²¨/ê°’ë§Œ ì •ë¦¬ (ì–¸ì–´ë³„ ë¼ë²¨ ì‚¬ìš©)
	  contentEl.innerHTML = `
	    <div class="day-summary-item">
	      <div class="day-summary-term">${labelSleep()}</div>
	      <div class="day-summary-desc">${sleepText}</div>
	    </div>
	    <div class="day-summary-item">
	      <div class="day-summary-term">${labelMood()}</div>
	      <div class="day-summary-desc">${moodText}</div>
	    </div>
	    <div class="day-summary-item">
	      <div class="day-summary-term">${labelWater()}</div>
	      <div class="day-summary-desc">${waterText}</div>
	    </div>
	  `;

	  // ğŸ”¹ í•˜ë£¨ ì½”ë©˜íŠ¸ ë©”ì‹œì§€ëŠ” ì™„ì „íˆ ì œê±° (ê¹”ë”í•˜ê²Œ)
	  commentEl.textContent = "";
	}

    // ì´ˆê¸° ìƒíƒœ: ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    (function init(){
      const initialSleep = sleepInput ? Number(sleepInput.value || "7") : 7;
      updateSleepUI(initialSleep);
      updateMoodUI("ok");
      renderWater();
      const todayStr = `${today.getFullYear()}-${pad2(today.getMonth()+1)}-${pad2(today.getDate())}`;
      loadDay(todayStr);      // ì˜¤ëŠ˜ DBì— ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’
      loadSummary();          // ì§€ë‚œ 7ì¼ í†µê³„
      loadCalendarMonth();    // ì´ë²ˆ ë‹¬ ê¸°ë¡ í‘œì‹œ
    })();
  </script>
</body>
</html>
